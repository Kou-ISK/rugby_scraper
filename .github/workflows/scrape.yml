name: Scrape Rugby Matches

on:
  schedule:
    - cron: '0 0 * * 0' # 毎週UTC 00:00に実行（日曜）
  workflow_dispatch: # 手動実行用

permissions:
  contents: write

jobs:
  scrape-matches:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          persist-credentials: true
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - name: Install Chrome
        run: |
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable
      - name: Run scrapers
        run: |
          python -m src.main six-nations
          python -m src.main six-nations-women
          python -m src.main six-nations-u20
          python -m src.main epcr-challenge
          python -m src.main epcr-champions
          python -m src.main top14
          python -m src.main league-one
          python -m src.main gallagher-premiership
          python -m src.main urc
          python -m src.main super-rugby-pacific
          python -m src.main world-rugby-internationals
      - name: Commit and push if changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/matches/
          git diff --cached --quiet || git commit -m "Update match data"
          git push
